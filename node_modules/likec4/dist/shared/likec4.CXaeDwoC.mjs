import{invariant as pe,isNonEmptyArray as ue}from"@likec4/core";import{relative as fe}from"node:path";import{t as ge}from"./likec4.DO_7oUns.mjs";import{t as he,a as A}from"./likec4.CB2-Uaub.mjs";import{t as me}from"./likec4.DOUP9ptn.mjs";import{f as we,g as J,T as Ie,N as V,i as Ne,e as x,j as _,u as N,t as ye,a as ve,n as $e,b as Le,c as ke,d as G,L as je}from"./likec4.BSr9pG1Z.mjs";import{compareNatural as Se}from"@likec4/core/utils";import{b as W}from"./likec4.H8IcXBiE.mjs";import{RichText as Ce}from"@likec4/core/types";
function z(...t){return me(Re,t)}function Re(t,e){let i={};for(let n of e)n in t&&(i[n]=t[n]);return i}function Te(t){var e,i;if(t){if("astNode"in t)return be(t);if(Array.isArray(t))return t.reduce(B,void 0);{const n=t,r=Ee(n)?Me((i=(e=n?.root)===null||e===void 0?void 0:e.astNode)!==null&&i!==void 0?i:n?.astNode):void 0;return S(n,r)}}else return}function Ee(t){return typeof t<"u"&&"element"in t&&"text"in t}function Me(t){try{return J(t).uri.toString()}catch{return}}function be(t){var e,i;const{
astNode:n,property:r,index:a}=t??{},c=(e=n?.$cstNode)!==null&&e!==void 0?e:n?.$textRegion;if(!(n===void 0||c===void 0)){if(r===void 0)return S(c,D(n));{const o=d=>a!==void 0&&a>-1&&Array.isArray(n[r])?a<d.length?d[a]:void 0:d.reduce(B,void 0);if(!((i=c.assignments)===null||i===void 0)&&i[r]){const d=o(c.assignments[r]);return d&&S(d,D(n))}else if(n.$cstNode){const d=o(we(n.$cstNode,r));return d&&S(d,D(n))}else return}}}function D(t){var e,i,n,r;return t.$cstNode?(i=(e=J(t))===null||e===void 0?void 0:
e.uri)===null||i===void 0?void 0:i.toString():t.$textRegion?t.$textRegion.documentURI||((r=(n=new Ie(t,a=>a.$container?[a.$container]:[]).find(a=>{var c;return(c=a.$textRegion)===null||c===void 0?void 0:c.documentURI}))===null||n===void 0?void 0:n.$textRegion)===null||r===void 0?void 0:r.documentURI):void 0}function S(t,e){var i,n;const r={offset:t.offset,end:(i=t.end)!==null&&i!==void 0?i:t.offset+t.length,length:(n=t.length)!==null&&n!==void 0?n:t.end-t.offset};return t.range&&(r.range=t.range),
e??(e=t.fileURI),e&&(r.fileURI=e),r}function B(t,e){var i,n;if(t){if(!e)return t&&S(t)}else return e&&S(e);const r=(i=t.end)!==null&&i!==void 0?i:t.offset+t.length,a=(n=e.end)!==null&&n!==void 0?n:e.offset+e.length,c=Math.min(t.offset,e.offset),o=Math.max(r,a),d=o-c,u={offset:c,end:o,length:d};if(t.range&&e.range&&(u.range={start:e.range.start.line<t.range.start.line||e.range.start.line===t.range.start.line&&e.range.start.character<t.range.start.character?e.range.start:t.range.start,end:e.range.
end.line>t.range.end.line||e.range.end.line===t.range.end.line&&e.range.end.character>t.range.end.character?e.range.end:t.range.end}),t.fileURI||e.fileURI){const f=t.fileURI,g=e.fileURI,p=f&&g&&f!==g?`<unmergable text regions of ${f}, ${g}>`:f??g;u.fileURI=p}return u}class xe{constructor(e){this.defaultIndentation="    ",this.pendingIndent=!0,this.currentIndents=[],this.recentNonImmediateIndents=[],this.traceData=[],this.lines=[[]],this.length=0,typeof e=="string"?this.defaultIndentation=e:typeof e==
"number"&&(this.defaultIndentation="".padStart(e))}get content(){return this.lines.map(e=>e.join("")).join("")}get contentLength(){return this.length}get currentLineNumber(){return this.lines.length-1}get currentLineContent(){return this.lines[this.currentLineNumber].join("")}get currentPosition(){return{offset:this.contentLength,line:this.currentLineNumber,character:this.currentLineContent.length}}append(e,i){if(e.length>0){const n=i&&this.currentPosition;this.lines[this.currentLineNumber].push(
e),this.length+=e.length,n&&this.indentPendingTraceRegions(n)}}indentPendingTraceRegions(e){for(let i=this.traceData.length-1;i>=0;i--){const n=this.traceData[i];n.targetStart&&n.targetStart.offset===e.offset&&(n.targetStart=this.currentPosition)}}increaseIndent(e){this.currentIndents.push(e),e.indentImmediately||this.recentNonImmediateIndents.push(e)}decreaseIndent(){this.currentIndents.pop()}get relevantIndents(){return this.currentIndents.filter(e=>!this.recentNonImmediateIndents.includes(e))}resetCurrentLine(){
this.length-=this.lines[this.currentLineNumber].join("").length,this.lines[this.currentLineNumber]=[],this.pendingIndent=!0,this.recentNonImmediateIndents.length=0}addNewLine(){this.lines.push([]),this.pendingIndent=!0,this.recentNonImmediateIndents.length=0}pushTraceRegion(e){const i=Ue(e,this.currentPosition,n=>{var r,a;return(a=(r=this.traceData[this.traceData.length-1])===null||r===void 0?void 0:r.children)===null||a===void 0?void 0:a.push(n)});return this.traceData.push(i),i}popTraceRegion(e){
const i=this.traceData.pop();return this.assertTrue(i===e,"Trace region mismatch!"),i}getParentTraceSourceFileURI(){var e;for(let i=this.traceData.length-1;i>-1;i--){const n=(e=this.traceData[i].sourceRegion)===null||e===void 0?void 0:e.fileURI;if(n)return n}}assertTrue(e,i){if(!e)throw new Error(i)}}function Ue(t,e,i){const n={sourceRegion:t,targetRegion:void 0,children:[],targetStart:e,complete:r=>{var a,c;return n.targetRegion={offset:n.targetStart.offset,end:r.offset,length:r.offset-n.targetStart.
offset,range:{start:{line:n.targetStart.line,character:n.targetStart.character},end:{line:r.line,character:r.character}}},delete n.targetStart,((a=n.children)===null||a===void 0?void 0:a.length)===0&&delete n.children,!((c=n.targetRegion)===null||c===void 0)&&c.length&&i(n),delete n.complete,n}};return n}function Pe(t,e){const i=new xe(e),n=i.pushTraceRegion(void 0);q(t,i),i.popTraceRegion(n),n.complete&&n.complete(i.currentPosition);const r=n.children&&n.children.length===1?n.children[0]:void 0,
a=r?.targetRegion,c=n.targetRegion;return a&&r.sourceRegion&&a.offset===c.offset&&a.length===c.length?{text:i.content,trace:r}:{text:i.content,trace:n}}function q(t,e){typeof t=="string"?_e(t,e):t instanceof F?De(t,e):t instanceof h?K(t,e):t instanceof E&&Oe(t,e)}function Y(t,e){return typeof t=="string"?t.length!==0:t instanceof h?t.contents.some(i=>Y(i,e)):t instanceof E?!(t.ifNotEmpty&&e.currentLineContent.length===0):!1}function _e(t,e){t&&(H(e,!1),e.append(t))}function H(t,e){var i;if(t.pendingIndent){
let n="";for(const r of t.relevantIndents.filter(a=>a.indentEmptyLines||!e))n+=(i=r.indentation)!==null&&i!==void 0?i:t.defaultIndentation;t.append(n,!0),t.pendingIndent=!1}}function K(t,e){let i;const n=Te(t.tracedSource);n&&(i=e.pushTraceRegion(n));for(const r of t.contents)q(r,e);if(i){e.popTraceRegion(i);const r=e.getParentTraceSourceFileURI();r&&n?.fileURI===r&&delete n.fileURI,i.complete&&i.complete(e.currentPosition)}}function De(t,e){var i;if(Y(t,e)){t.indentImmediately&&!e.pendingIndent&&
e.append((i=t.indentation)!==null&&i!==void 0?i:e.defaultIndentation,!0);try{e.increaseIndent(t),K(t,e)}finally{e.decreaseIndent()}}}function Oe(t,e){t.ifNotEmpty&&!Fe(e.currentLineContent)?e.resetCurrentLine():(H(e,!0),e.append(t.lineDelimiter),e.addNewLine())}function Fe(t){return t.trimStart()!==""}Object.freeze("__\xABSKIP^NEW^LINE^IF^EMPTY\xBB__");const Ae=/\S|$/;function Je(t){const e=t.filter(n=>n.length>0).map(n=>n.search(Ae)),i=e.length===0?0:Math.min(...e);return Math.max(0,i)}function L(t,...e){
const i=Ge(t),n=We(t,e,i);return Be(n)}function Ve(t,e,i){return(n,...r)=>Ye(t,e,i)(L(n,...r))}function Ge(t){const e=t.join("_").split(V),i=e.length>1&&e[0].trim().length===0,n=i&&e.length>1&&e[e.length-1].trim().length===0;if(e.length===1||e.length!==0&&e[0].trim().length!==0||e.length===2&&e[1].trim().length===0)return{indentation:0,omitFirstLine:i,omitLastLine:n,trimLastLine:e.length!==1&&e[e.length-1].trim().length===0};{let r=i?e.slice(1):e;r=n?r.slice(0,r.length-1):r,r=r.filter(c=>c.length!==
0);const a=Je(r);return{indentation:a,omitFirstLine:i,omitLastLine:n&&(e[e.length-1].length<a||!e[e.length-1].startsWith(r[0].substring(0,a)))}}}function We(t,e,{indentation:i,omitFirstLine:n,omitLastLine:r,trimLastLine:a}){const c=[];t.forEach((u,f)=>{c.push(...u.split(V).map((g,p)=>p===0||g.length<i?g:g.substring(i)).reduce(f===0?(g,p,w)=>w===0?n?[]:[p]:w===1&&g.length===0?[p]:g.concat(U,p):(g,p,w)=>w===0?[p]:g.concat(U,p),[]).filter(g=>!(typeof g=="string"&&g.length===0)).concat(T(e[f])?e[f]:
e[f]!==void 0?{content:String(e[f])}:f<e.length?X:[]))});const o=c.length,d=o!==0?c[o-1]:void 0;return(r||a)&&typeof d=="string"&&d.trim().length===0?n&&o!==1&&c[o-2]===U?c.slice(0,o-2):c.slice(0,o-1):c}const U={isNewLine:!0},X={isUndefinedSegment:!0},Q=t=>t===U,O=t=>t===X,ze=t=>t.content!==void 0;function Be(t){return t.reduce((i,n,r)=>O(n)?i:Q(n)?{node:r!==0&&(O(t[r-1])||T(t[r-1]))||r>1&&typeof t[r-1]=="string"&&(O(t[r-2])||T(t[r-2]))?i.node.appendNewLineIfNotEmpty():i.node.appendNewLine()}:(()=>{
var a;const c=(r===0||Q(t[r-1]))&&typeof n=="string"&&n.length!==0?"".padStart(n.length-n.trimStart().length):"",o=ze(n)?n.content:n;let d;return{node:i.indented?i.node:c.length!==0?i.node.indent({indentation:c,indentImmediately:!1,indentedChildren:u=>d=u.append(o)}):i.node.append(o),indented:d??((a=i.indented)===null||a===void 0?void 0:a.append(o))}})(),{node:new h}).node}const qe=typeof process>"u"?`
`:process.platform==="win32"?`\r
`:`
`;function T(t){return t instanceof h||t instanceof F||t instanceof E}function k(t,e){return T(t)?Pe(t,e).text:String(t)}class h{constructor(...e){this.contents=[],this.append(...e)}isEmpty(){return this.contents.length===0}trace(e,i,n){if(Ne(e)){if(this.tracedSource={astNode:e,property:i,index:n},this.tracedSource.property===void 0&&this.tracedSource.index!==void 0&&this.tracedSource.index>-1)throw new Error("Generation support: 'property' argument must not be 'undefined' if a non-negative valu\
e is assigned to 'index' in 'CompositeGeneratorNode.trace(...)'.")}else this.tracedSource=e;return this}append(...e){for(const i of e)typeof i=="function"?i(this):i&&this.contents.push(i);return this}appendIf(e,...i){return e?this.append(...i):this}appendNewLine(){return this.append(s)}appendNewLineIf(e){return e?this.append(s):this}appendNewLineIfNotEmpty(){return this.append(He)}appendNewLineIfNotEmptyIf(e){return e?this.appendNewLineIfNotEmpty():this}appendTemplate(e,...i){return this.append(
L(e,...i))}appendTemplateIf(e){return e?(i,...n)=>this.appendTemplate(i,...n):()=>this}indent(e){const{indentedChildren:i,indentation:n,indentEmptyLines:r,indentImmediately:a}=Array.isArray(e)||typeof e=="function"?{indentedChildren:e}:typeof e=="object"?e:{},c=new F(n,a,r);return this.contents.push(c),Array.isArray(i)?c.append(...i):i&&c.append(i),this}appendTraced(e,i,n){return r=>this.append(new h().trace(e,i,n).append(r))}appendTracedIf(e,i,n,r){return e?this.appendTraced(typeof i=="function"?
i():i,n,r):()=>this}appendTracedTemplate(e,i,n){return(r,...a)=>this.append(Ve(e,i,n)(r,...a))}appendTracedTemplateIf(e,i,n,r){return e?this.appendTracedTemplate(typeof i=="function"?i():i,n,r):()=>this}}function Ye(t,e,i){return n=>n instanceof h&&n.tracedSource===void 0?n.trace(t,e,i):new h().trace(t,e,i).append(n)}class F extends h{constructor(e,i=!0,n=!1){super(),this.indentImmediately=!0,this.indentEmptyLines=!1,typeof e=="string"?this.indentation=e:typeof e=="number"&&(this.indentation="".
padStart(e)),this.indentImmediately=i,this.indentEmptyLines=n}}class E{constructor(e,i=!1){this.ifNotEmpty=!1,this.lineDelimiter=e??qe,this.ifNotEmpty=i}}const s=new E,He=new E(void 0,!0),Z=t=>t===void 0||typeof t=="string"||T(t)?t:String(t);function y(t,e=Z,i={}){const n=typeof e=="function"?e:Z,{filter:r,prefix:a,suffix:c,separator:o,appendNewLineIfNotEmpty:d,skipNewLineAfterLastItem:u}=typeof e=="object"?e:i,f=typeof a=="function"?a:(()=>a),g=typeof c=="function"?c:(()=>c);return Ke(t,(p,w,l,m)=>{
if(r&&!r(w,l,m))return p;const I=n(w,l,m);return I===void 0?p:(p??(p=new h)).append(f(w,l,m)).append(I).append(g(w,l,m)).appendIf(!m,o).appendNewLineIfNotEmptyIf(!p.isEmpty()&&!!d&&(!m||!u))})}function Ke(t,e,i){const n=t[Symbol.iterator]();let r=n.next(),a=0,c=i;for(;!r.done;){const o=n.next();c=e(c,r.value,a,!!o.done),r=o,a++}return c}const Xe=t=>t.charAt(0).toLocaleUpperCase()+t.slice(1),Qe=t=>t.split(".").map(Xe).join(""),Ze=t=>Qe(t.parent?t.id.slice(t.parent.length+1):t.id),et=({autoLayout:t})=>{
switch(t.direction){case"TB":return"down";case"BT":return"up";case"LR":return"right";case"RL":return"left"}},tt=({shape:t})=>{switch(t){case"queue":case"cylinder":case"rectangle":case"person":return t;case"storage":return"stored_data";case"mobile":case"browser":return"rectangle"}};function ee(t){const e=t.$view,{nodes:i,edges:n}=e,r=new Map,a=(o,d)=>{const u=Ze(o),f=(d?d+".":"")+u;r.set(o.id,f);const g=JSON.stringify(o.title),p=tt(o);return new h().append(u,": {",s).indent({indentedChildren:w=>w.
append("label: ",g,s).appendIf(p!=="rectangle","shape: ",p,s).appendIf(o.children.length>0,s,y(i.filter(l=>l.parent===o.id),l=>a(l,f))),indentation:2}).append("}",s)},c=o=>new h().append(r.get(o.source)," -> ",r.get(o.target)).append(d=>o.label&&d.append(": ",JSON.stringify(o.label)));return k(new h().append("direction: ",et(e),s,s).append(y(i.filter(o=>x(o.parent)),o=>a(o),{appendNewLineIfNotEmpty:!0})).appendIf(n.length>0,s,y(n,o=>c(o),{appendNewLineIfNotEmpty:!0})))}const nt=t=>t.charAt(0).toLocaleUpperCase()+
t.slice(1),it=t=>t.split(".").map(nt).join(""),rt=t=>it(t.parent?t.id.slice(t.parent.length+1):t.id),ot=({shape:t})=>{switch(t){case"queue":case"cylinder":return["[(",")]"];case"person":return["[fa:fa-user ","]"];case"storage":return["([","])"];case"mobile":case"browser":case"rectangle":return["[","]"]}};function te(t){const e=t.$view,{nodes:i,edges:n}=e,r=new Map,a=(o,d)=>{const u=rt(o),f=(d?d+".":"")+u;r.set(o.id,f);const g=o.title.replaceAll(`
`,"\\n"),p=ot(o),w=new h;return o.children.length>0?w.append("subgraph ",f,"[",JSON.stringify(o.title),"]",s).indent({indentedChildren:[y(i.filter(l=>l.parent===o.id),l=>a(l,f),{appendNewLineIfNotEmpty:!0})],indentation:2}).append("end",s):w.append(f,p[0],g,p[1]),w},c=o=>new h().append(r.get(o.source)," -.",o.label?' "'+o.label.replaceAll(`
`,"\\n")+'" .-':"-","> ",r.get(o.target));return k(new h().appendIf(e.title!==null&&e.title.length>0,"---",s,`title: ${JSON.stringify(e.title)}`,s,"---",s).append("graph ",e.autoLayout.direction,s).indent({indentedChildren:o=>{o.append(y(i.filter(d=>x(d.parent)),d=>a(d),{appendNewLineIfNotEmpty:!0})).appendIf(n.length>0,y(n,d=>c(d),{appendNewLineIfNotEmpty:!0}))},indentation:2}))}const at=t=>t.charAt(0).toLocaleUpperCase()+t.slice(1),P=t=>t.split(".").map(at).join(""),ne=t=>P(t.parent?t.id.slice(
t.parent.length+1):t.id),C=(t,e,i="#3b82f6")=>t?e(t)??i:i,st=({autoLayout:t})=>{switch(t.direction){case"TB":return"top to bottom";case"BT":return console.warn("Bottom to top direction is not supported. Defaulting to top to bottom."),"top to bottom";case"LR":return"left to right";case"RL":return console.warn("Right to left direction is not supported. Defaulting to left to right."),"left to right"}},ie=({shape:t})=>{switch(t){case"queue":case"rectangle":case"person":return t;case"storage":case"cy\
linder":return"database";case"mobile":case"browser":return"rectangle"}},R=t=>x(t)?null:JSON.stringify(t).slice(1,-1);function re(t){const e=t.$view,i=t.$model.$styles.theme.colors,{nodes:n,edges:r}=e,a=l=>m=>m in i?i[m].elements[l]:void 0,c=l=>m=>m in i?i[m].relationships[l]:void 0,o=new Map,d=()=>new h().append('title "',e.title||e.id,'"',s).append(st(e)," direction",s),u=()=>new h().append("hide stereotype",s).append("skinparam ranksep ","60",s).append("skinparam nodesep ","30",s).append("skin\
param {",s).indent({indentedChildren:l=>l.append("arrowFontSize ","10",s).append("defaultTextAlignment ","center",s).append("wrapWidth ","200",s).append("maxMessageSize ","100",s).append("shadowing ","false",s),indentation:2}).append("}",s),f=l=>{const m=ie(l),I=P(l.id);return new h().append("skinparam ",m,"<<",I,">>","{",s).indent({indentedChildren:$=>$.append("BackgroundColor ",C(l.color,a("fill")),s).append("FontColor ",C(l.color,a("hiContrast"),"#FFFFFF"),s).append("BorderColor ",C(l.color,a(
"stroke")),s),indentation:2}).append("}",s)},g=l=>{const m=ie(l),I=P(l.id),$=R(l.title)||ne(l),v=R(l.technology);o.set(l.id,I);const b=Ce.from(l.description);return new h().append(m," ").append('"').append("==",$).appendIf(!!v,"\\n","<size:10>[",v,"]</size>").appendIf(b.nonEmpty,"\\n\\n",R(b.text)).append('"'," <<",I,">> ","as ",I,s)},p=l=>{const m=R(l.title)||ne(l),I=P(l.id);return o.set(l.id,I),new h().append('rectangle "',m,'" <<',I,">> as ",I," {",s).indent({indentedChildren:$=>$.append("ski\
nparam ","RectangleBorderColor<<",I,">> ",C(l.color,a("fill")),s).append("skinparam ","RectangleFontColor<<",I,">> ",C(l.color,a("fill")),s).append("skinparam ","RectangleBorderStyle<<",I,">> ","dashed",s,s).append(y(n.filter(v=>v.parent===l.id),v=>v.children.length>0?p(v):g(v))),indentation:2}).append("}",s)},w=l=>{const m=R(l.technology)||"",I=R(l.label)||"",$=C(l.color,c("line"),"#777777"),v=b=>`<color:${b}>`;return new h().append(o.get(l.source)," .[",$,",thickness=2].> ",o.get(l.target)).appendIf(
!!(I||m),' : "',v($)).appendIf(!!I,I,v($)).appendIf(!!(I&&m),"\\n").appendIf(!!m,v($),"<size:8>[",m,"]</size>").appendIf(!!(I||m),'"').append(s)};return k(new h().append("@startuml",s).append(d(),s).append(u(),s).append(y(n.filter(l=>l.children.length==0),l=>f(l),{appendNewLineIfNotEmpty:!0})).append(y(n.filter(l=>x(l.parent)),l=>l.children.length>0?p(l):g(l),{appendNewLineIfNotEmpty:!0})).appendIf(r.length>0,s,y(r,l=>w(l),{appendNewLineIfNotEmpty:!0})).append("@enduml",s))}function j(t){return{
matches:e=>{let{module:i,projectId:n}=e.match(/^likec4:plugin\/(?<projectId>.+)\/(?<module>.+)$/)?.groups??e.match(/^likec4:(?<module>.+)\/(?<projectId>.+)$/)?.groups??{};return!i||!n?null:(i.endsWith(".js")&&(i=i.slice(0,-3)),i===t?n:null)},virtualId:e=>_("likec4:plugin",e,t)+".js"}}const dt={"<":"\\u003C",">":"\\u003E","/":"\\u002F","\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","\0":"\\0","\u2028":"\\u2028","\u2029":"\\u2029"};function ct(t){return t.replace(/[<>\b\f\n\r\t\0\u2028\u2029\\]/g,
e=>dt[e])}function M(t,e){return{id:`likec4:${t}`,virtualId:`likec4:plugin/${t}.js`,async load({logger:i,projects:n}){i.info(N.dim(`generating likec4:${t}`));const r=n.map(({id:a})=>{const c=ct(JSON.stringify(_(`likec4:${t}`,a)));return`  ${JSON.stringify(a)}: () => import(${c})`});return`
export let ${e}Fn = {
${r.join(`,
`)}
}      

export async function ${e}(projectId) {
  const fn = ${e}Fn[projectId]
  if (!fn) {
    throw new Error('Unknown projectId: ' + projectId)
  }
  return await fn()
}

if (import.meta.hot) {
  import.meta.hot.accept(md => {
    if (!import.meta.hot.data.$update) {
      import.meta.hot.data.$update = ${e}Fn
    }
    const update = md.${e}Fn
    if (update) {
      Object.assign(import.meta.hot.data.$update, update)
    } else {
      import.meta.hot.invalidate()
    }
  })
}
    `}}}function lt(t){const e=new h;return e.appendTemplate`
    /******************************************************************************
     * This file was generated
     * DO NOT EDIT MANUALLY!
     ******************************************************************************/
    /* eslint-disable */

    export function d2Source(viewId) {
      switch (viewId) {
  `.appendNewLine().indent({indentation:4,indentedChildren(i){i.append(y([...t.views()],n=>L`
              case ${JSON.stringify(n.id)}: {
                return ${JSON.stringify(ee(n))}
              }
            `,{appendNewLineIfNotEmpty:!0})).appendTemplate`
        default: {
          throw new Error('Unknown viewId: ' + viewId)
        }
      `}}).append(s,"  }",s).appendTemplate`
    }
    `.append(s,s),k(e)}const pt={...j("d2"),async load({likec4:t,project:e,logger:i}){i.info(N.dim(`generating likec4:d2/${e.id}`));const n=await t.computedModel(e.id);return lt(n)}},ut=M("d2","loadD2Sources");function ft(t){const e=new h;return e.appendTemplate`
    /******************************************************************************
     * This file was generated
     * DO NOT EDIT MANUALLY!
     ******************************************************************************/
    /* eslint-disable */

    export function dotSource(viewId) {
      switch (viewId) {
  `.appendNewLine().indent({indentation:4,indentedChildren(i){i.append(y(Object.keys(t),n=>L`
              case ${JSON.stringify(n)}: {
                return ${JSON.stringify(t[n].dot)}
              }
            `,{appendNewLineIfNotEmpty:!0})).appendTemplate`
          default: {
            throw new Error('Unknown viewId: ' + viewId)
          }
        `}}).append(s,"  }",s).appendTemplate`
    }

    export function svgSource(viewId) {
      switch (viewId) {
    `.appendNewLine().indent({indentation:4,indentedChildren(i){i.append(y(Object.keys(t),n=>L`
              case ${JSON.stringify(n)}: {
                return ${JSON.stringify(t[n].svg)}
              }
            `,{appendNewLineIfNotEmpty:!0})).appendTemplate`
          default: {
            throw new Error('Unknown viewId: ' + viewId)
          }
        `}}).append(s,"  }",s,"}",s,s),k(e)}const gt={...j("dot"),async load({likec4:t,project:e,logger:i}){i.info(N.dim(`generating likec4:dot/${e.id}`));const n=await t.views.viewsAsGraphvizOut(e.id),r=ye(n,({id:a,svg:c,dot:o})=>[a,{dot:o,svg:c}]);return ft(r)}},ht=M("dot","loadDotSources");function mt(t){const e=he(t.flatMap(r=>r.nodes.map(a=>a.icon)),Le(r=>ke(r)&&!(r.toLowerCase().startsWith("http:")||r.toLowerCase().startsWith("https:"))),$e(),ve(Se)),{imports:i,cases:n}=e.reduce((r,a,c)=>{
const o=a.startsWith("file:"),d="Icon"+c.toString().padStart(2,"0");if(o)return r.imports.push(`import ${d} from '${a}?inline'`),r.cases.push(`  '${a}': () => jsx('img', { src: ${d} })`),r;const[u,f]=a.split(":");return r.imports.push(`import ${d} from 'likec4/icons/${u}/${f}'`),r.cases.push(`  '${u}:${f}': ${d}`),r},{imports:[],cases:[]});return`
import { jsx } from 'react/jsx-runtime'
${i.join(`
`)}

const Icons = {
${n.join(`,
`)}
}
export function IconRenderer(props) {
  const IconComponent = Icons[props.node.icon ?? '']
  if (!IconComponent) {
    return null
  }
  return jsx(IconComponent, props)
}
`}const wt={...j("icons"),async load({likec4:t,project:e,logger:i}){i.info(N.dim(`generating likec4:icons/${e.id}`));const n=await t.views.computedViews(e.id);return mt(n)}},It={id:"likec4:icons",virtualId:"likec4:plugin/icons.jsx",async load({projects:t,logger:e}){e.info(N.dim("generating likec4:icons"));const{imports:i,cases:n}=t.reduce((r,{id:a},c)=>{const o="Icons"+c.toString().padStart(2,"0"),d=_("likec4:icons",a);return r.imports.push(`import { IconRenderer as ${o} } from ${JSON.stringify(
d)}`),r.cases.push(`   case ${JSON.stringify(a)}: return ${o}`),r},{imports:[],cases:[]});return`
import { jsx } from 'react/jsx-runtime'    
${i.join(`
`)}

function getProjectIcons(projectId) {
  switch (projectId) {
${n.join(`
`)}
    default:
      throw new Error('Unknown projectId: ' + projectId)
  }
}

export function ProjectIcons({ projectId, ...props }) {
  const IconComponent = getProjectIcons(projectId)
  return jsx(IconComponent, props)
}
`}};function Nt(t){const e=new h;return e.appendTemplate`
    /******************************************************************************
     * This file was generated
     * DO NOT EDIT MANUALLY!
     ******************************************************************************/
    /* eslint-disable */

    export function mmdSource(viewId) {
      switch (viewId) {
  `.appendNewLine().indent({indentation:4,indentedChildren(i){i.append(y([...t.views()],n=>L`
              case ${JSON.stringify(n.id)}: {
                return ${JSON.stringify(te(n))}
              }
            `,{appendNewLineIfNotEmpty:!0})).appendTemplate`
          default: {
            throw new Error('Unknown viewId: ' + viewId)
          }
        `}}).append(s,"  }",s).appendTemplate`
    }

    `.append(s,s),k(e)}const yt={...j("mmd"),async load({likec4:t,project:e,logger:i}){i.info(N.dim(`generating virtual:likec4/mmd/${e.id}`));const n=await t.computedModel(e.id);return Nt(n)}},vt=M("mmd","loadMmdSources"),$t=t=>`
import { createHooksForModel, atom } from 'likec4/vite-plugin/internal'

export const $likec4data = atom(${W.stringify(t.$data)})

export const {
  updateModel,
  $likec4model,
  useLikeC4Model,
  useLikeC4Views,
  useLikeC4View
} = createHooksForModel($likec4data)

if (import.meta.hot) {
  import.meta.hot.accept(md => {
    if (!import.meta.hot.data.$update) {
      import.meta.hot.data.$update = updateModel
    }
    const update = md.$likec4data?.get()
    if (update) {
      import.meta.hot.data.$update(update)
    } else {
      import.meta.hot.invalidate()
    }
  })
}
`,Lt={...j("model"),async load({likec4:t,project:e,logger:i}){i.info(N.dim(`generating likec4:model/${e.id}`));const n=await t.layoutedModel(e.id);return $t(n)}},oe=M("model","loadModel"),kt=t=>`
export const isSingleProject = ${t.length===1};
export const projects = ${W.stringify(t,null,2)};
`,ae={id:"likec4:projects",virtualId:"likec4:plugin/projects.js",async load({logger:t,projects:e}){return t.info(N.dim("generating likec4:projects")),kt(A(e,z(["id","title"])))}};function jt(t){const e=new h;return e.appendTemplate`
    /******************************************************************************
     * This file was generated
     * DO NOT EDIT MANUALLY!
     ******************************************************************************/
    /* eslint-disable */

    export function pumlSource(viewId) {
      switch (viewId) {
  `.appendNewLine().indent({indentation:4,indentedChildren(i){i.append(y([...t.views()],n=>L`
              case ${JSON.stringify(n.id)}: {
                return ${JSON.stringify(re(n))}
              }
            `,{appendNewLineIfNotEmpty:!0})).appendTemplate`
        default: {
          throw new Error('Unknown viewId: ' + viewId)
        }
      `}}).append(s,"  }",s).appendTemplate`
    }
    `.append(s,s),k(e)}const St={...j("puml"),async load({likec4:t,project:e,logger:i}){i.info(N.dim(`generating likec4:puml/${e.id}`));const n=await t.computedModel(e.id);return jt(n)}},Ct=M("puml","loadPumlSources"),se=t=>`
import { jsx as _jsx } from "react/jsx-runtime";
import { LikeC4ModelProvider as Provider, LikeC4View as GenericView, ReactLikeC4 as GenericReactLikeC4 } from 'likec4/react';
import { IconRenderer } from 'likec4:icons/${t}'

import { useLikeC4Model, useLikeC4Views, useLikeC4View } from 'likec4:model/${t}'

export function LikeC4ModelProvider({ children }) {
  const likeC4Model = useLikeC4Model()
  return (_jsx(Provider, { likec4model: likeC4Model, children: children }));
}
export function LikeC4View(props) {
  return (_jsx(LikeC4ModelProvider, { children: _jsx(GenericView, { renderIcon: IconRenderer, ...props }) }));
}
export function ReactLikeC4(props) {
  return (_jsx(LikeC4ModelProvider, { children: _jsx(GenericReactLikeC4, { renderIcon: IconRenderer, ...props }) }));
}

export {
  useLikeC4Model,
  useLikeC4View,
  useLikeC4Views
}
`,Rt={...j("react"),async load({project:t,logger:e}){return e.info(N.dim(`generating likec4:react/${t.id}`)),se(t.id)}},Tt={id:"likec4:react",virtualId:"likec4:plugin/react.js",async load({logger:t,projects:e}){const i=G(e);return t.info(N.dim("generating likec4:react for")+" "+i.id),se(i.id)}},Et=t=>`
export { IconRenderer } from 'likec4:icons/${t}'
export {
  $likec4data,
  $likec4model,
  useLikeC4Model,
  useLikeC4Views,
  useLikeC4View
} from 'likec4:model/${t}'
export const projectId = ${JSON.stringify(t)}
`,Mt={id:"likec4:single-project",virtualId:"likec4:plugin/single-project.js",async load({logger:t,projects:e}){const i=G(e);return t.info(N.dim("generating likec4:single-project for")+" "+i.id),Et(i.id)}},de=[Lt,wt,pt,gt,yt,St],ce=[...de,Rt],le=[ae,oe,Mt,Tt,ut,ht,vt,Ct,It];function bt({useOverviewGraph:t=!1,...e}){let i,n,r,a,c=e.watch??!1;return{name:"vite-plugin-likec4",async configResolved(o){if(i=o.root,n=o.logger,t===!0){const d=o.resolve.alias.find(u=>u.find==="likec4/previews")?.replacement;
d?(a=d,n.info(N.dim("likec4/previews alias")+" "+N.dim(a))):n.warn("likec4/previews alias not found")}if(e.languageServices)r=e.languageServices;else{const d=c=e.watch??o.mode==="development";r=(await je.fromWorkspace(e.workspace??o.root,{logger:n,graphviz:e.graphviz??"wasm",printErrors:e.printErrors??!0,throwIfInvalid:e.throwIfInvalid??!1,watch:d})).languageServices}a=r.workspaceUri.fsPath},resolveId(o){for(const d of ce){const u=d.matches(o);if(u)return d.virtualId(u)}for(const d of le)if(d.id===
o)return d.virtualId;return null},async load(o){for(const d of ce){const u=d.matches(o);if(u){const f=r.project(u);return await d.load({logger:n,likec4:r,project:f,assetsDir:a,useOverviewGraph:t})}}for(const d of le)if(d.virtualId===o){const u=r.projects();return pe(ue(u)),await d.load({logger:n,likec4:r,projects:u,assetsDir:a,useOverviewGraph:t})}return null},configureServer(o){const d=()=>A(r.projects(),z(["id","title"]));let u=d();const f=async g=>{const p=o.moduleGraph.getModuleById(g);if(p&&
p.importers.size>0){n.info(`${N.green("reload")} ${N.dim(p.id??p.url)}`);try{await o.reloadModule(p)}catch(w){n.error(w)}}};r.builder.onModelParsed(async()=>{const[g]=r.getErrors();if(g){o.ws.send({type:"error",err:{name:"LikeC4ValidationError",message:`Validation failed
`+g.message.slice(0,500),stack:"",plugin:"vite-plugin-likec4",loc:{file:fe(i,g.sourceFsPath),line:g.range.start.line+1,column:g.range.start.character+1}}});return}const p=d();ge(p,u)||(u=p,await f(ae.virtualId),await f(oe.virtualId));for(const w of u)for(const l of de)await f(l.virtualId(w.id))})},async buildEnd(){c&&await r.dispose()}}}export{h as C,bt as L,s as N,te as a,ee as b,L as e,re as g,y as j,k as t};
